{% extends "base/base.html" %}

{% block title %}Error interno del servidor - {{ super() }}{% endblock %}

{% block page_css %}
<style>
.error-container {
    min-height: 60vh;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.error-content {
    max-width: 500px;
    padding: 2rem;
}

.error-code {
    font-size: 8rem;
    font-weight: 900;
    color: var(--color-danger);
    line-height: 1;
    margin-bottom: 1rem;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
}

.error-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--color-text-primary);
    margin-bottom: 1rem;
}

.error-description {
    font-size: 1.1rem;
    color: var(--color-text-secondary);
    margin-bottom: 2rem;
    line-height: 1.6;
}

.error-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

.error-illustration {
    width: 200px;
    height: 200px;
    margin: 0 auto 2rem;
    opacity: 0.8;
}

.error-details {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border-light);
    border-radius: var(--border-radius);
    padding: 1rem;
    margin: 1.5rem 0;
    text-align: left;
    font-family: var(--font-mono);
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    max-height: 200px;
    overflow-y: auto;
}

.error-id {
    font-size: 0.8rem;
    color: var(--color-text-muted);
    margin-top: 1rem;
    font-family: var(--font-mono);
}

@media (max-width: 768px) {
    .error-code {
        font-size: 6rem;
    }
    
    .error-title {
        font-size: 1.5rem;
    }
    
    .error-actions {
        flex-direction: column;
        align-items: center;
    }
}
</style>
{% endblock %}

{% block main_content %}
<div class="error-container">
    <div class="error-content">
        <!-- Ilustración SVG -->
        <div class="error-illustration">
            <svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="100" cy="100" r="80" fill="var(--color-bg-secondary)" stroke="var(--color-danger)" stroke-width="2"/>
                <path d="M70 85L130 85M70 100L130 100M70 115L110 115" stroke="var(--color-danger)" stroke-width="3" stroke-linecap="round"/>
                <circle cx="100" cy="140" r="25" fill="none" stroke="var(--color-warning)" stroke-width="3"/>
                <path d="M100 130L100 140M100 145L100 150" stroke="var(--color-warning)" stroke-width="3" stroke-linecap="round"/>
                <path d="M85 60C85 60 90 50 100 50C110 50 115 60 115 60" stroke="var(--color-text-secondary)" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </div>
        
        <!-- Código de error -->
        <div class="error-code">500</div>
        
        <!-- Título -->
        <h1 class="error-title">Error interno del servidor</h1>
        
        <!-- Descripción -->
        <p class="error-description">
            Oops! Algo salió mal en nuestros servidores. Nuestro equipo técnico ha sido notificado 
            y está trabajando para resolver el problema.
        </p>
        
        {% if config.DEBUG and error_details %}
        <!-- Detalles del error (solo en modo debug) -->
        <div class="error-details">
            <strong>Detalles técnicos:</strong><br>
            {{ error_details | safe }}
        </div>
        {% endif %}
        
        <!-- ID del error para soporte -->
        <div class="error-id">
            ID del error: {{ error_id or 'ERR-' + moment().format('YYYYMMDD-HHmmss') }}
        </div>
        
        <!-- Acciones -->
        <div class="error-actions">
            <button onclick="location.reload()" class="btn btn-primary">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Reintentar
            </button>
            
            <a href="{{ url_for('core.index') }}" class="btn btn-outline">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                </svg>
                Ir al inicio
            </a>
            
            {% if current_user.is_authenticated %}
            <a href="{{ url_for('dashboard.index') }}" class="btn btn-outline">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                Dashboard
            </a>
            {% endif %}
        </div>
        
        <!-- Información adicional -->
        <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--color-border-light);">
            <p style="font-size: 0.9rem; color: var(--color-text-muted);">
                Si el problema persiste, por favor contacta a nuestro 
                <a href="mailto:soporte@datalab.com" class="text-primary hover:underline">equipo de soporte</a> 
                con el ID del error mostrado arriba.
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_js %}
<script>
// Agregar animación de entrada
document.addEventListener('DOMContentLoaded', function() {
    const errorContent = document.querySelector('.error-content');
    errorContent.style.opacity = '0';
    errorContent.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
        errorContent.style.transition = 'all 0.5s ease-out';
        errorContent.style.opacity = '1';
        errorContent.style.transform = 'translateY(0)';
    }, 100);
    
    // Auto-retry después de 30 segundos (opcional)
    let retryTimer = 30;
    const retryBtn = document.querySelector('button[onclick="location.reload()"]');
    const originalText = retryBtn.innerHTML;
    
    const countdown = setInterval(() => {
        retryTimer--;
        if (retryTimer > 0) {
            retryBtn.innerHTML = originalText.replace('Reintentar', `Reintentar (${retryTimer})`);
        } else {
            clearInterval(countdown);
            retryBtn.innerHTML = originalText;
        }
    }, 1000);
    
    // Limpiar countdown si el usuario hace clic
    retryBtn.addEventListener('click', () => {
        clearInterval(countdown);
    });
});
</script>
{% endblock %}